@{
    @model ZonaRival.Models.ViewModels.EquipoViewModel;
                                                                                                                                                                                                  
}
<!-- HTML BIENVENIDA -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZonaRival - Inicio</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/index.css" asp-append-version="true">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background">
        <!-- Elementos decorativos del fondo -->
        <div class="starball starball-1"></div>
        <div class="starball starball-2"></div>

        <!-- Contenedor principal -->
        <div class="home-container">
            <div class="welcome-section">
                <h1 class="welcome-message">Bienvenido a ZonaRival</h1>
                <p class="motivational-quote" id="motivational-quote"></p>
            </div>

            <div class="sections-container">
                <!-- Apartado de información del equipo -->
                <div class="section">
                    <h2 class="section-title">Información del Equipo</h2>
                    <div class="team-info">
                        <div class="info-item">
                            <span class="info-label">Nombre del Equipo:</span>
                            <span class="info-value" data-team-name>@(Model.equipoViewModel.NombreEquipo ?? "Sin nombre")</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Cantidad de Jugadores:</span>
                            <span class="info-value" data-players-count>@(Model.equipoViewModel.CantidadJugadores > 0 ? Model.equipoViewModel.CantidadJugadores.ToString() : "No especificado")</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Rango de Edad:</span>
                            <span class="info-value" data-age-range>@(Model.equipoViewModel.RangoEdad ?? "No especificado")</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Color de Uniforme:</span>
                            <span class="info-value" data-uniform-color>@(Model.equipoViewModel.ColorUniforme ?? "No especificado")</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">Canchas de Preferencia:</span>
                            <span class="info-value" data-preferred-courts>
                                @if (Model.equipoViewModel.EquiposCanchas != null && Model.equipoViewModel.EquiposCanchas.Any())
                                {
                                    var canchasValidas = Model.equipoViewModel.EquiposCanchas
                                    .Where(ec => ec != null && ec.Cancha != null && ec.Cancha.NombreCancha != null)
                                    .Select(ec => ec.Cancha.NombreCancha);
                                    if (canchasValidas.Any())
                                    {
                                        @string.Join(", ", canchasValidas)
                                    }
                                    else
                                    {
                                        @: Ninguna
                                    }
                                }
                                else
                                {
                                    @: Ninguna
                                }
                            </span>
                        </div>
                    </div>
                    <button type="button" class="edit-btn" data-bs-toggle="modal" data-bs-target="#editModal">Editar Información</button>
                </div>

              
                <!-- Apartado de equipos disponibles -->
                <div class="section">
                    <h2 class="section-title">Equipos Disponibles</h2>
                    <div class="available-teams">
                        <div class="row" data-teams-list>
                            @foreach (var equipo in Model.ListaEquipos)
                            {
                                <div class="col-12 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">Nombre: @equipo.NombreEquipo</h5>
                                            <h5>Jugadores: @equipo.CantidadJugadores</h5>
                                            <h5>Color: @equipo.ColorUniforme</h5>
                                            <h5>Edad: @equipo.RangoEdad</h5>
                                            <h5>Canchas: @string.Join(", ", equipo.EquiposCanchas?.Where(ec => ec?.Cancha != null).Select(ec => ec.Cancha.NombreCancha) ?? new List<string>())</h5>

                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#challengeModal" data-equipo-id="@equipo.EquipoId">Desafiar</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <form asp-action="ToggleDisponibilidad" asp-controller="Equipo" method="post">
                        <input type="hidden" name="equipoId" value="@Model.equipoViewModel.EquipoId" />
                        @if (Model.equipoViewModel.Disponibilidad)
                        {
                            <button type="submit" class="disable-btn">Quitar Disponibilidad</button>
                        }
                        else
                        {
                            <button type="submit" class="availability-btn">Habilitar Disponibilidad</button>
                        }
                    </form>
                </div>

                <!-- Apartado de encuentros pendientes -->
                <div class="pending-section">
                    <h2 class="section-title">Encuentros Pendientes</h2>
                    <div class="pending-teams">
                        @if (Model.ListaEncuentrosPendientes != null && Model.ListaEncuentrosPendientes.Any())
                        {
                            @foreach (var solicitud in Model.ListaEncuentrosPendientes)
                            {
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">@(solicitud.EquipoRetadorId == Model.equipoViewModel.EquipoId ? solicitud.EquipoDesafiado.NombreEquipo : solicitud.EquipoRetador.NombreEquipo)</h5>
                                        <h5>Modalidad: @solicitud.Modalidad</h5>
                                        <h5>Cancha: @solicitud.Cancha.NombreCancha</h5>
                                        <h5>Fecha: @solicitud.Fecha.ToString("yyyy-MM-dd")</h5>
                                        <h5>Hora: @solicitud.Hora</h5>
                                        <h5>Estado: @solicitud.Estado</h5>
                                        <div class="phone-info" style="display: none;">
                                            <p>Teléfono: @(solicitud.EquipoRetadorId == Model.equipoViewModel.EquipoId ? solicitud.EquipoDesafiado.Usuarios.FirstOrDefault()?.Telefono ?? "No disponible" : solicitud.EquipoRetador.Usuarios.FirstOrDefault()?.Telefono ?? "No disponible")</p>
                                        </div>
                                        @if (solicitud.EquipoDesafiadoId == Model.equipoViewModel.EquipoId)
                                        {
                                            <form method="post" asp-controller="Equipo" asp-action="AceptarDesafio" style="display: inline;">
                                                <input type="hidden" name="IdPartido" value="@solicitud.PartidoId" />
                                                <button type="submit" class="accept-btn">Aceptar</button>
                                            </form>
                                            <form method="post" asp-controller="Equipo" asp-action="RechazarDesafio" style="display: inline;">
                                                <input type="hidden" name="desafioId" value="@solicitud.PartidoId" />
                                                <button type="submit" class="reject-btn">Rechazar</button>
                                            </form>
                                        }
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p>No hay encuentros pendientes.</p>
                        }
                    </div>
                </div>

                <!-- Apartado de partidos confirmados -->
                <div class="confirmed-section">
                    <h2 class="section-title">Partidos Confirmados</h2>
                    <div class="confirmed-teams">
                        @if (Model.ListaPartidosConfirmados != null && Model.ListaPartidosConfirmados.Any())
                        {
                            @foreach (var partido in Model.ListaPartidosConfirmados)
                            {
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">@(partido.EquipoRetadorId == Model.equipoViewModel.EquipoId ? partido.EquipoDesafiado.NombreEquipo : partido.EquipoRetador.NombreEquipo)</h5>
                                        <h5>Modalidad: @partido.Modalidad</h5>
                                        <h5>Cancha: @partido.Cancha.NombreCancha</h5>
                                        <h5>Fecha: @partido.Fecha.ToString("yyyy-MM-dd")</h5>
                                        <h5>Hora: @partido.Hora</h5>
                                        <h5>Estado: @partido.Estado</h5>
                                        <div class="phone-info">
                                            <p>Teléfono: @(partido.EquipoRetadorId == Model.equipoViewModel.EquipoId ? partido.EquipoDesafiado.Usuarios.FirstOrDefault()?.Telefono ?? "No disponible" : partido.EquipoRetador.Usuarios.FirstOrDefault()?.Telefono ?? "No disponible")</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p>No hay partidos confirmados.</p>
                        }
                    </div>
                </div>

                <!-- Apartado de historial de partidos -->
                <div class="section">
                    <h2 class="section-title">Historial de Partidos</h2>
                    <div class="match-history">
                        <ul class="history-list" data-match-history>
                            <!-- Historial de partidos se cargará dinámicamente -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar información del equipo -->
    <div class="modal fade modal-custom" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Editar Información del Equipo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <form id="editTeamForm" method="post" asp-controller="Equipo" asp-action="EditarEquipo">
                    <input type="hidden" name="EquipoId" value="@Model.equipoViewModel.EquipoId" />
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="NombreEquipo" class="form-label">Nombre del Equipo</label>
                            <input type="text" class="form-control" id="NombreEquipo" name="NombreEquipo" value="@Model.equipoViewModel.NombreEquipo" required>
                        </div>
                        <div class="mb-3">
                            <label for="CantidadJugadores" class="form-label">Cantidad de Jugadores</label>
                            <input type="number" class="form-control" id="CantidadJugadores" name="CantidadJugadores" value="@Model.equipoViewModel.CantidadJugadores" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="RangoEdad" class="form-label">Rango de Edad</label>
                            <select id="RangoEdad" name="RangoEdad" class="form-control" required>
                                <option value="">@Model.equipoViewModel.RangoEdad</option>
                                <option value="15-20">15 – 20 años</option>
                                <option value="21-25">21 – 25 años</option>
                                <option value="26-30">26 – 30 años</option>
                                <option value="31-35">31 – 35 años</option>
                                <option value="36-40">36 – 40 años</option>
                                <option value="40+">40+ años</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="ColorUniforme" class="form-label">Color de Uniforme</label>
                            <input type="text" class="form-control" id="ColorUniforme" name="ColorUniforme" value="@Model.equipoViewModel.ColorUniforme" required>
                        </div>
                       <!--
                           @*
                        <div class="mb-3">
                            <label for="preferredCourts" class="form-label">Canchas de preferencia</label>
                            <div class="courts-container">
                                @{
                                    var canchas = Model.equipoViewModel.EquiposCanchas?.Where(ec => ec?.Cancha != null).Select(ec => ec.Cancha.NombreCancha).ToList() ?? new List<string>();
                                    for (int i = 0; i < 3; i++)
                                    {
                                        var value = i < canchas.Count ? canchas[i] : "";
                                        <input type="text" id="preferredCourt@(i+1)" name="canchas[@i].NombreCancha" placeholder="@(i+1)ra opción" value="@value">
                                    }
                                }
                            </div>
                        </div>
                        *@
                        -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para desafiar equipo -->
    <div class="modal fade modal-custom" id="challengeModal" tabindex="-1" aria-labelledby="challengeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header challenge-header">
                    <h5 class="modal-title" id="challengeModalLabel">Desafiar Equipo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <!-- Bloque para mostrar el mensaje de error -->
                @if (!string.IsNullOrEmpty(ViewBag.Error))
                {
                    <div class="error-message" style="color: red; margin-bottom: 15px;">@ViewBag.Error</div>
                }
                <form id="challengeForm" method="post" asp-controller="Equipo" asp-action="DesafiarEquipo">
                    <input type="hidden" name="equipoDesafiadoId" id="equipoDesafiadoId" />
                    <input type="hidden" name="equipoRetadorId" value="@Model.equipoViewModel.EquipoId" />
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="Modalidad" class="form-label">Modalidad</label>
                            <select id="Modalidad" name="modalidad" class="form-control" required>
                                <option value="">Selecciona una modalidad</option>
                                <option value="Fútbol 5">Fútbol 5</option>
                                <option value="Fútbol 7">Fútbol 7</option>
                                <option value="Fútbol 9">Fútbol 9</option>
                                <option value="Fútbol 11">Fútbol 11</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="Cancha" class="form-label">Cancha</label>
                            <select id="Cancha" name="canchaId" class="form-control" required>
                                <option value="">Selecciona una cancha</option>
                                @if (Model.ListaCanchas != null && Model.ListaCanchas.Any())
                                {
                                    foreach (var cancha in Model.ListaCanchas)
                                    {
                                        <option value="@cancha.CanchaId">@cancha.NombreCancha</option>
                                    }
                                }
                                else
                                {
                                    <option value="">No hay canchas registradas</option>
                                }
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="Fecha" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="Fecha" name="fecha" required>
                        </div>
                        <div class="mb-3">
                            <label for="Hora" class="form-label">Hora</label>
                            <input type="time" class="form-control" id="Hora" name="hora" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Enviar Desafío</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Array de frases motivacionales sobre fútbol
        const motivationalPhrases = [
            "El fútbol es la poesía de los movimientos.",
            "Gana o pierde, pero nunca te rindas en el campo.",
            "El éxito no es definitivo, el fracaso no es fatal: es el coraje para continuar lo que cuenta.",
            "En el fútbol, como en la vida, lo importante es jugar con el corazón.",
            "Cada partido es una nueva oportunidad para demostrar tu pasión.",
            "El verdadero campeón es aquel que se levanta después de caer.",
            "El fútbol une a las personas y crea recuerdos inolvidables.",
            "La victoria pertenece al más perseverante.",
            "Juega con inteligencia, corre con determinación.",
            "El balón no conoce de colores, solo de talento."
        ];

        // Función para seleccionar una frase al azar
        function getRandomPhrase() {
            const randomIndex = Math.floor(Math.random() * motivationalPhrases.length);
            return motivationalPhrases[randomIndex];
        }

        // Asignar la frase al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const quoteElement = document.getElementById('motivational-quote');
            quoteElement.textContent = getRandomPhrase();
        });

        // Configurar modal de desafío
        $(document).on('click', 'button[data-bs-toggle="modal"][data-bs-target="#challengeModal"]', function() {
            var equipoId = $(this).data('equipo-id');
            $('#equipoDesafiadoId').val(equipoId);
        });

        // Función para mostrar/ocultar información de teléfono al aceptar desafío
        function togglePhone(button) {
            const cardBody = button.closest('.card-body');
            const phoneInfo = cardBody.querySelector('.phone-info');
            if (phoneInfo.style.display === 'none' || phoneInfo.style.display === '') {
                phoneInfo.style.display = 'block';
            } else {
                phoneInfo.style.display = 'none';
            }
        }
    </script>
</body>
</html>
